# Gradle优化

## 官方文档

[官方文档](https://developer.android.com/studio/build/optimize-your-build?hl=zh-cn)

**怎么优化，都不如官方的优化来的舒畅，持续关注官方文档，保持最新版本的gradle，自然而然让你的编译速度更上一层楼**

## 找出性能瓶颈

* 编译总觉得慢，可是多久才算慢是主观的体会，唯有翔实的数据才能说明问题，gradle官方为我们提供了专门的工具使用，gradle assemble --profile生成整个编译过程的相关文档
* 找出各个编译子流程的耗时，从中找到耗时的、异常的、有优化空间的内容进行优化

## 理解执行流程

* 1.输入命令行开始编译，首先会根据项目结构，遍历每个子模块的build.gradle文件，并且执行一次配置操作，此时执行的只是gradle的脚本代码，并没有开始打包
* 2.gradle执行新增代码之类的操作会生成代码、资源等内容到build文件夹当中
* 3.开始执行官方打包流程，首先打包子项目，然后再到主项目打包成最终完整apk
* 4.编译过程中某些sdk为了简化接入方式还会对生成的class进行操作，这些操作常常时非常耗时的，如何让这些操作在需要的时候才执行是优化编译速度的重要一步
* 5.最终打包完整apk

## 奇技淫巧解决

* 终极方法：换个强劲机器编译比任何优化都管用（换台MBP爽歪歪），服务器编译甚优
* 开发过程中使用Instant Run，官方方式提高编译速度，提供开发效率
* gradle脚本中的耗时操作应在真正需要的时候才进行，或者创建开发的flaver对这些操作进行简化
* debug版本减少release版本的一些步骤：混淆，检查方法数等等，减少开发过程中对这些非必要处理的耗时，曾经遇到个项目就是有个检查方法数的内容一直没有删除，导致每次都会浪费大量时间在重复的无用功上。
* debug版本减少正式包功能：firebase等的crash统计
* debug版本减少动态生成代码功能，用固定代码替换动态代码：将时间打包进apk，google的firebase每次动态生成代码打入apk等等，动态代码生成最大影响是每次编译都会有新代码，导致每次都需要编译，当没有做任何修改时，只是想要点一下快速安装一下apk，却导致又重新打包，非常恼火
* 减少重复编译的操作：某些so编译，预先打包debug和release版本so，在打包apk时引入即可，不需要在每次都重新编译一次
